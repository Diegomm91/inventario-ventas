       IDENTIFICATION DIVISION.
       PROGRAM-ID. TRANS-PROC.
       AUTHOR. PORTFOLIO-DEV.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT ACCOUNTS-FILE ASSIGN TO "ACCOUNTS.DAT"
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS ACCOUNT-ID
               FILE STATUS IS WS-FS-ACCOUNTS.

       DATA DIVISION.
       FILE SECTION.
       FD  ACCOUNTS-FILE.
       COPY "ACCOUNT.CPY".

       WORKING-STORAGE SECTION.
       01  WS-VARIABLES.
           05  WS-FS-ACCOUNTS      PIC X(02).
           05  WS-EOF-SWITCH       PIC X(01) VALUE 'N'.
           05  WS-TRANS-AMOUNT     PIC S9(07)V99 VALUE 500.00.

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-OPEN-FILES
           IF WS-FS-ACCOUNTS = "00"
               PERFORM 2000-PROCESS-ACCOUNTS
           ELSE
               DISPLAY "ERROR OPENING FILE: " WS-FS-ACCOUNTS
           END-IF
           PERFORM 3000-CLOSE-FILES
           GOBACK.

       1000-OPEN-FILES.
           OPEN I-O ACCOUNTS-FILE.

       2000-PROCESS-ACCOUNTS.
           READ ACCOUNTS-FILE NEXT
               AT END SET WS-EOF-SWITCH TO 'Y'
           END-READ
           PERFORM UNTIL WS-EOF-SWITCH = 'Y'
               DISPLAY "PROCESSING: " CUSTOMER-NAME
               ADD WS-TRANS-AMOUNT TO BALANCE
               REWRITE ACCOUNT-RECORD
               READ ACCOUNTS-FILE NEXT
                   AT END SET WS-EOF-SWITCH TO 'Y'
               END-READ
           END-PERFORM.

       3000-CLOSE-FILES.
           CLOSE ACCOUNTS-FILE.
